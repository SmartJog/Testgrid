#!/bin/bash
#chmod a+x test.sh

set -e -o pipefail
 ( false ; echo ok ; ) || echo error

PACKAGE_IS="kvm libvirt-bin virtinst gdisk kpartx  mdadm  python-progressbar=2.3-0.2 python-installsystems installsystems"
PACKAGE="lvm2 bridge-utils"
VOLUME_XML_TEMPLATE="vg_template.xml"
PV_NAME="/dev/sda6"
VG_NAME="vg"

for pkg in $PACKAGE_IS $PACKAGE; do
if apt-get -qq install pkg ; then
	echo "Successfully installed $pkg"
    else
	echo "Error installing $pkg"
	#package couldn't installed
    fi
done


#Writing physical volume data to disk name
pvcreate $PV_NAME
if [ $? -eq 0 ]; then
    echo OK
else
    echo FAIL
fi

#creation volume groupe
vgcreate $VG_NAME  $PV_NAME

sed -e "s/\${name}/${VG_NAME}/" $VOLUME_XML_TEMPLATE > "${VG_NAME}.xml"

#define libvirt pool using volume group  
virsh pool-define "${VG_NAME}.xml"
virsh pool-start $VG_NAME
virsh pool-autostart $VG_NAME
virsh pool-info $VG_NAME